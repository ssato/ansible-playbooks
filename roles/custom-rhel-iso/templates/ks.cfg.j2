install
cdrom
text
bootloader
keyboard us
lang {{ kickstart.lang|default('en_US.UTF-8') }}
rootpw {{ kickstart.rootpw }}
timezone Asia/Tokyo
auth --useshadow --passalgo=sha512
selinux --enforcing
firewall --enabled --service=mdns,ssh,http,https
xconfig --startxonboot
zerombr
clearpart --all
part / --size 1 --grow
services {{ '--enabled=%s' % kickstart.services.enabled|join(',')
            if kickstart.services.enabled is defined and kickstart.services.enabled -}}
         {{ ' --disabled=%s' % kickstart.services.disabled|join(',')
            if kickstart.services.disabled is defined and kickstart.services.disabled }}
network --bootproto=dhcp --device=link --activate
shutdown
{%  if kickstart.repos is defined and kickstart.repos -%}
{%-    for repo in kickstart.repos if repo.name and (repo.baseurl or repo.mirrorlist) -%}
repo --name={{ repo.name }} {{ '--baseurl=%s' % repo.baseurl if repo.baseurl is defined and repo.baseurl }} {{ '--mirrorlist=%s' % repo.mirrorlist if repo.mirrorlist is defined and repo.mirrorlist }} {{ repo.options if repo.options is defined and repo.options }}
{%     endfor -%}
{%- endif %}

%packages --ignoremissing
{% for pkg in kickstart.packages -%}
{{     pkg }}
{% else %}
@core
@base
{% endfor %}
%end

%post
for key in /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-{release,beta}; do \
  test -f ${key} && rpm --import ${key} || :; done

f=/root/.bashrc
test -f $f && \
echo "export LC_ALL=en_US.UTF-8" >> $f || \
(cat << EOF > $f
test -f /etc/bashrc && . /etc/bashrc || :
export LC_ALL=en_US.UTF-8
EOF
)
test -d /root/setup || mkdir -p /root/setup
touch /root/setup/kickstart.post.stamp
%end
